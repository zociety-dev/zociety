#!/bin/bash
# setup: Initialize zociety repository
# Run this once after cloning

set -e

echo "Setting up zociety..."

# Make all bin scripts executable
chmod +x bin/*
echo "✓ Scripts made executable"

# Initialize learnings branch if it doesn't exist
if ! git show-ref --verify --quiet refs/heads/learnings; then
  echo "Initializing learnings branch..."
  CURRENT=$(git branch --show-current)
  git checkout --orphan learnings
  git rm -rf . --quiet 2>/dev/null || true
  cat > LEARNINGS.md << 'EOF'
# Zociety Learnings

Insights preserved across cycles. Each cycle adds, nothing deleted.

EOF
  git add LEARNINGS.md
  git commit -m "Initialize learnings branch"
  git checkout "$CURRENT"
  echo "✓ Learnings branch created"
else
  echo "✓ Learnings branch exists"
fi

# Install pre-commit hooks if pre-commit is available
if command -v pre-commit &> /dev/null; then
  pre-commit install
  echo "✓ Pre-commit hooks installed"
else
  echo "⚠ pre-commit not found (optional: pip install pre-commit)"
fi

echo ""
echo "Setup complete!"
echo ""
echo "Container setup (required for running loops):"
echo "  1. echo 'sk-ant-...' > container/secrets/anthropic_api_key"
echo "  2. chmod 600 container/secrets/anthropic_api_key"
echo "  3. bin/zociety --build"
echo ""
echo "Run the loop:"
echo "  bin/zociety ralph-loop"
