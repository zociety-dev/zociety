#!/bin/bash
# validate-state: Validate zociety repository state
# Used by pre-commit hook for quality control
#
# Checks:
#   - PROMPT.md exists
#   - bin/zstate is executable
#   - No orphaned state files from old system

set -e

ERRORS=0

# Check PROMPT.md exists
if [[ -f PROMPT.md ]]; then
  echo "✓ PROMPT.md exists"
else
  echo "✗ PROMPT.md missing"
  ERRORS=$((ERRORS + 1))
fi

# Check z* tools are executable
for tool in bin/zstate bin/zjoin bin/zstuff bin/zvote bin/zevent; do
  if [[ -x "$tool" ]]; then
    echo "✓ $tool is executable"
  elif [[ -f "$tool" ]]; then
    echo "⚠ $tool exists but not executable (run chmod +x)"
  fi
done

# Warn about orphaned old-system files (informational, not errors)
OLD_FILES=(DIRECTION.md .batch members.txt rules.txt)
for f in "${OLD_FILES[@]}"; do
  if [[ -f "$f" ]]; then
    echo "⚠ Found old-system file: $f (should not exist in rev50+)"
  fi
done

# Check for .out directory (should not exist)
if [[ -d ".out" ]]; then
  echo "⚠ Found .out/ directory (vestigial, can be removed)"
fi

if [[ $ERRORS -gt 0 ]]; then
  exit 1
fi

exit 0
